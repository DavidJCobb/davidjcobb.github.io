---
title: Ray/cylinder intersections
tags:
 - 3D
 - geometry
 - intersection
 - math
 - raycasting
social_media:
   description: The math behind doing raycasts for 3D cylinder. Includes public-domain code.
extra_css_files:
 - lu-math2.css
   
---
{%- include lu-math/defines.html -%}

{%- comment -%}
   
   Generate convenience variables for lu-math equation numbers. To display equation number 5, for example:
   {{lu_math_eq_numbers[5]}}
   
{%- endcomment -%}
{%- assign lu_math_eq_numbers = "" -%}
{%- for i in (1..20) -%}
   {%- capture temporary -%}
      <m-equation-number>
         <m-rawcap> </m-rawcap>
         <m-raw>[Equation </m-raw><m-value>{{i}}</m-value><m-raw>:]</m-raw>
         <m-rawcap> </m-rawcap>
      </m-equation-number>
   {%- endcapture -%}
   {%- assign temporary = temporary | prepend: "SPLITTER" -%}
   {%- assign lu_math_eq_numbers = lu_math_eq_numbers | append: temporary -%}
{%- endfor -%}
{%- assign lu_math_eq_numbers = lu_math_eq_numbers | split: "SPLITTER" -%}

{%- comment -%}
   
   Generate convenience variables for vector-length start and end tags. It is imperative that no whitespace 
   be present in these variables.
   
{%- endcomment -%}
{%- capture temporary -%}
   <m-veclength>
      <m-delim>||</m-delim>
      <m-content>%CONTENT%</m-content>
      <m-delim>||</m-delim>
   </m-veclength>
{%- endcapture -%}
{%- assign temporary  = temporary | strip_newlines | strip | split: " " -%}
{%- assign temporary2 = "" -%}
{%- assign temporary3 = false -%} {%- comment -%} In tag? {%- endcomment -%}
{%- assign temporary4 = false -%}
{%-comment-%}
   Comments so Notepad++'s syntax highlighter doesn't choke.
   <!--
{%-endcomment-%}
{%- for item in temporary -%}
   {%- assign temporary2 = temporary2 | append: item -%}
{%- endfor -%}
{%-comment-%}
   -->
   End of syntax highlighter comment.
{%-endcomment-%}
{%- assign temporary = temporary2 | split: "%CONTENT%" -%}
{%- assign lu_math_vec_start = temporary[0] -%}
{%- assign lu_math_vec_end = temporary[1] -%}

{%- capture lu_math_therefore_block -%}
   <m-therefore data-block>
      <span aria-hidden="true" title="therefore">&therefore;</span>
      <m-raw data-screen-reader-only>&therefore;</m-raw>
   </m-therefore>
{%- endcapture -%}

{%- assign math_inl_enter = "<lu-math data-inline>" -%}
{%- assign math_inl_leave = "</lu-math>" -%}
{%- assign var_Ca_inl = "<var>C<sub>a</sub></var>" | prepend: math_inl_enter | append: math_inl_leave -%}
{%- assign var_Cb_inl = "<var>C<sub>b</sub></var>" | prepend: math_inl_enter | append: math_inl_leave -%}
{%- assign var_Cr_inl = "<var>C<sub>r</sub></var>" | prepend: math_inl_enter | append: math_inl_leave -%}
{%- assign var_Cs_inl = "<var>C<sub>s</sub></var>" | prepend: math_inl_enter | append: math_inl_leave -%}
{%- assign var_Hd_inl = "<var>H<sub>d</sub></var>" | prepend: math_inl_enter | append: math_inl_leave -%}
{%- assign var_Hp_inl = "<var>H<sub>p</sub></var>" | prepend: math_inl_enter | append: math_inl_leave -%}
{%- assign var_Hs_inl = "<var>H<sub>s</sub></var>" | prepend: math_inl_enter | append: math_inl_leave -%}
<section>
   <p>
      There are a lot of people out on the web who are willing to share raycasting code, 
      but not a whole lot of them bother to actually apply a permissive license to it so 
      that people can legally use it. What's more, a lot of them don't explain how they 
      actually derived the math involved either.
   </p>
   <p>
      Here, I'm going to walk through how to put together a ray/cylinder intersection test. 
      I've also provided code at the bottom as a public domain work.
   </p>
</section>

<section>
   <h2><a name="parametric"></a>Parametric surface of a cylinder</h2>
   <p>
      The parametric equations (that is, equations with parameters) for a cylinder are as follows:
   </p>
   <lu-math>
      <m-givens>
         <label>Given:</label>
         <dl>
            <dt><var>C<sub>h</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>height of the cylinder</dd>
            <dt><var>C<sub>r</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>radius of the cylinder</dd>
            <dt><var>H<sub>o</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>height offset on the range [0, <var>C<sub>h</sub></var>], where 0 is aligned with an endcap</dd>
            <dt><var>&theta;</var></dt>
            <m-sep> = </m-sep>
               <dd>any angle, basically</dd>
         </dl>
      </m-givens>
      <m-layout-left>
         {{lu_math_eq_numbers[1]}}
         <m-row>
            <m-function-def>
               <m-name>f<sub>x</sub></m-name><!--
            --><m-args><!--
               --><m-delim>(</m-delim>
                     <m-arg><var>H<sub>o</sub></var></m-arg>
                  <m-sep>, </m-sep>
                     <m-arg><var>&theta;</var></m-arg>
                  <m-delim>)</m-delim><!--
            --></m-args>
            </m-function-def>
            =
            <var>C<sub>r</sub></var> &times; cos(<var>&theta;</var>)
         </m-row>
         <m-row>
            <m-function-def>
               <m-name>f<sub>y</sub></m-name><!--
            --><m-args><!--
               --><m-delim>(</m-delim>
                     <m-arg><var>H<sub>o</sub></var></m-arg>
                  <m-sep>, </m-sep>
                     <m-arg><var>&theta;</var></m-arg>
                  <m-delim>)</m-delim><!--
            --></m-args>
            </m-function-def>
            =
            <var>C<sub>r</sub></var> &times; sin(<var>&theta;</var>)
         </m-row>
         <m-row>
            <m-function-def>
               <m-name>f<sub>z</sub></m-name><!--
            --><m-args><!--
               --><m-delim>(</m-delim>
                     <m-arg><var>H<sub>o</sub></var></m-arg>
                  <m-sep>, </m-sep>
                     <m-arg><var>&theta;</var></m-arg>
                  <m-delim>)</m-delim><!--
            --></m-args>
            </m-function-def>
            =
            <var>H<sub>o</sub></var>
         </m-row>
      </m-layout-left>
   </lu-math>
   <p>
      Technically, these equations describe an infinite cylinder &mdash; one with no endcaps, which extends forever in both directions. However, we can still use them to put together the tests for a finite clinder with endcaps.
   </p>
   <p>
      You may notice that these are very similar to the parametric equations <a href="{% link _articles/ray-cone-intersection.html %}">for a cone</a>. Mathematically speaking, a cylinder is basically a cone with infinite height, and geometrically speaking, a cylinder is just a cone that never tapers. Moreover, if we ignore the Z-component, then we're literally just writing the equation for a 2D circle.
   </p>
</section>

<section>
   <h2><a name="implicit">Implicit surface of a cylinder</a></h2>
   <p>
      We have a <dfn>parametric surface</dfn> &mdash; that is, three parametric equations which define all points on the surface of the cylinder. In order to solve for any given part of the equation, however, we need an <dfn>implicit surface</dfn>: a surface defined by a single equation, wherein <lu-math data-inline><var>x</var></lu-math>, <lu-math data-inline><var>y</var></lu-math>, and <lu-math data-inline><var>z</var></lu-math> are on one side, and 0 is on the other side.
   </p>
   <p>
      The above equations basically define a 2D circle anchored at <lu-math data-inline>(0, 0)</lu-math> on the XY-plane, and then extend it infinitely along the Z-axis. The circle's radius is {{var_Cr_inl}}. This means that we can represent the X and Y equations in terms of any arbitrary 2D vector <lu-math data-inline><var>P<sub>2D</sub></var></lu-math>:
   </p>
   <lu-math>
      {{lu_math_eq_numbers[2]}}
      
      <m-veclength>
         <m-delim>||</m-delim><!--
      --><var>P<sub>2D</sub></var><!--
      --><m-delim>||</m-delim>
      </m-veclength>
      =
      <var>C<sub>r</sub></var>
   </lu-math>
   <p>
      If we project a 3D vector <lu-math data-inline><var>P</var></lu-math> onto the Z-axis, then we'll have just its Z-component. Remove that component, and we can then fit it into the equation above.
   </p>
   <lu-math>
      <m-givens>
         <label>Given:</label>
         <dl>
            <dt><var>P</var></dt>
            <m-sep> = </m-sep>
               <dd>any point on the curved surface of the infinite cylinder</dd>
            <dt><var>C<sub>a</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>axis of the cylinder; in this case, (0, 0, 1)</dd>
            <dt><var>P<sub>s</sub></var></dt>
            <m-sep> = </m-sep>
               <dd><var>P</var> projected onto <var>C<sub>a</sub></var></dd>
         </dl>
      </m-givens>
      <m-row>
         <var>P<sub>s</sub></var>
          = 
         (<var>P</var> &bullet; <var>C<sub>a</sub></var>)
          &times;
         <var>C<sub>a</sub></var>
      </m-row>
      <m-row>
         {{lu_math_eq_numbers[3]}}
         
         <m-veclength>
            <m-delim>||</m-delim><!--
         --><var>P</var> - <var>P<sub>s</sub></var><!--
         --><m-delim>||</m-delim>
         </m-veclength>
         =
         <var>C<sub>r</sub></var>
      </m-row>
   </lu-math>
   <p>
      If we so desire, we can now subtract {{var_Cr_inl}} from both sides of the equation in order to have one side contain only zero. As such, this is now an implicit surface, which defines a cylinder that has one endcap centered on <lu-math data-inline>(0, 0, 0)</lu-math>.
   </p>
</section>

<section>
   <h2><a name="transformed">Handling a translated and rotated cylinder</a></h2>
   <p>
      In general, we'll want to run raycasts against a bounded cylinder &mdash; one with endcaps, rather than one that extends infinitely along its axis. There's no equation that can represent a bounded cylinder directly. However, we can still represent an infinite cylinder in terms of where the endcaps <em>would</em> be, and then use some distance checks later to enforce bounds.
   </p>
   <p>
      Let's take the implicit surface of an infinite cylinder, and represent it in terms of the endcaps.
   </p>
   <lu-math>
      <m-givens>
         <label>Given:</label>
         <dl>
            <dt><var>C<sub>b</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>centerpoint of the cylinder's bottom endcap</dd>
            <dt><var>C<sub>t</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>centerpoint of the cylinder's top endcap</dd>
            <dt><var>C<sub>s</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>"spine" of the cylinder: a vector from the top to the bottom, equal to <var>C<sub>t</sub></var> - <var>C<sub>b</sub></var></dd>
            <dt><var>C<sub>a</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>axis of the cylinder: normalized spine</dd>
            <dt><var>H<sub>p</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>hit position: a point that we presume is on the cylinder's curved surface</dd>
            <dt><var>H<sub>s</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>hit spine position: the hit position projected onto <var>C<sub>s</sub></var>; this position = ((<var>H<sub>p</sub></var> - <var>C<sub>b</sub></var>) &bullet; <var>C<sub>a</sub></var>)<var>C<sub>a</sub></var> + <var>C<sub>b</sub></var></dd>
            <dt><var>H<sub>o</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>the height offset from our cylinder equations; this is the distance from <var>H<sub>s</sub></var> to <var>C<sub>b</sub></var> i.e. ||<var>H<sub>s</sub></var> - <var>C<sub>b</sub></var>||.</dd>
         </dl>
      </m-givens>
   </lu-math>
   <p>
      {{var_Hp_inl}} fills the role of <lu-math data-inline><var>P</var></lu-math> in Equation 3, and {{var_Hs_inl}} fills the role of <lu-math data-inline><var>P<sub>p</sub></var></lu-math>. {{var_Hs_inl}} is the hit position projected onto the cylinder's axis &mdash; its "spine." If we view the cylinder from its endcap, then {{var_Hs_inl}} will be at the center of a circle; if {{var_Hp_inl}} is indeed on the cylinder's curved surface, then the distance from it to {{var_Hs_inl}} will equal the cylinder's radius:
   </p>
   <lu-math>
      <m-row>
         <m-veclength>
            <m-delim>||</m-delim><!--
         --><var>H<sub>p</sub></var> - <var>H<sub>s</sub></var><!--
         --><m-delim>||</m-delim><!--
      --></m-veclength>
         =
         <var>C<sub>r</sub></var>
      </m-row>
   </lu-math>
   <p>
      We want to expand {{var_Hs_inl}} at this point, but there are actually two ways to do that. We can expand it in terms of {{var_Ca_inl}}, or in terms of {{var_Cs_inl}}. Let's go with {{var_Ca_inl}}, the cylinder axis vector, to get a smaller equation.
   </p>
   <lu-math>
      {{lu_math_eq_numbers[4]}}
      
      <m-row>
         <m-veclength>
            <m-delim>||</m-delim><!--
            --><var>H<sub>p</sub></var> - 
               ((<var>H<sub>p</sub></var> - <var>C<sub>b</sub></var>) &bullet; <var>C<sub>a</sub></var>)<var>C<sub>a</sub></var>
               + <var>C<sub>b</sub></var><!--
         --><m-delim>||</m-delim><!--
      --></m-veclength>
         =
         <var>C<sub>r</sub></var>
      </m-row>
   </lu-math>
   <p>
      Now, let's see if we can move {{var_Hp_inl}} outside of those inner dot products. A key thing to remember is that taking the dot product of two vectors can be manipulated just like multiplication. It has the following properties:
   </p>
   <ul>
      <li>
         It's <dfn>commutative</dfn>:
         <lu-math data-inline>
            <var>A</var> &bullet; <var>B</var> = <var>B</var> &bullet; <var>A</var>
         </lu-math>
      </li>
      <li>
         It's <dfn>distributive</dfn>:
         <lu-math data-inline>
            <var>A</var> &bullet; (<var>B</var> + <var>C</var>) = (<var>A</var> &bullet; <var>B</var>) + (<var>A</var> &bullet; <var>C</var>)
         </lu-math>
      </li>
      <li>
         And when <var>c</var> is a scalar, it's <dfn>associative</dfn>:
         <lu-math data-inline>
            (<var>A</var> &bullet; <var>B</var>)<var>c</var> = <var>c</var><var>A</var> &bullet; <var>c</var><var>B</var>
         </lu-math>
      </li>
   </ul>
   <p>
      So let's take advantage of that.
   </p>
   <lu-math>
      <m-solvestep>
         <m-content>
            <m-veclength>
               <m-delim>||</m-delim><!--
               --><var>H<sub>p</sub></var>
                  +
                  <var>C<sub>b</sub></var>
                  -
                  (<!--
                  -->(<var>H<sub>p</sub></var> &bullet; <mark><var>C<sub>a</sub></var></mark>)
                   - (<var>C<sub>b</sub></var> &bullet; <mark><var>C<sub>a</sub></var></mark>)<!--
               -->)<var>C<sub>a</sub></var><!--
            --><m-delim>||</m-delim><!--
         --></m-veclength>
            =
            <var>C<sub>r</sub></var>
         </m-content>
      </m-solvestep>
      <m-solvestep>
         <m-content>
            <m-veclength>
               <m-delim>||</m-delim><!--
               --><var>H<sub>p</sub></var>
                  +
                  <var>C<sub>b</sub></var>
                  -
                  (<var>H<sub>p</sub></var> &bullet; <var>C<sub>a</sub></var>)<mark><var>C<sub>a</sub></var>
                  + </mark>
                  (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<mark><var>C<sub>a</sub></var></mark><!--
            --><m-delim>||</m-delim><!--
         --></m-veclength>
            =
            <var>C<sub>r</sub></var>
         </m-content>
      </m-solvestep>
      <m-solvestep>
         <m-content>
            <m-veclength>
               <m-delim>||</m-delim><!--
               --><var>H<sub>p</sub></var>
                  +
                  <var>C<sub>b</sub></var>
                  -
                  (<var>H<sub>p</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>C<sub>a</sub></var>
                  + 
                  (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>C<sub>a</sub></var><!--
            --><m-delim>||</m-delim><!--
         --></m-veclength>
            =
            <var>C<sub>r</sub></var>
         </m-content>
      </m-solvestep>
   </lu-math>
</section>

<section>
   <h2><a name="solving">Solving for the ray</a></h2>
   <p>
      A ray is commonly defined in terms of a starting point, or <dfn>origin</dfn>, and a normalized direction vector. We can therefore define the hit position in terms of the same.
   </p>
   <lu-math>
      <m-givens>
         <label>Given:</label>
         <dl>
            <dt><var>R<sub>o</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>the ray's origin</dd>
            <dt><var>R<sub>d</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>the ray's direction</dd>
            <dt><var>H<sub>p</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>the position at which the ray hits some surface</dd>
            <dt><var>H<sub>d</sub></var></dt>
            <m-sep> = </m-sep>
               <dd>the hit distance: the distance from the ray origin to the hit position</dd>
         </dl>
      </m-givens>
      <m-row>
         <var>H<sub>p</sub></var><!--
      -->&nbsp;=&nbsp;<!--
      --><var>R<sub>o</sub></var> + <var>R<sub>d</sub></var><var>H<sub>d</sub></var>
      </m-row>
   </lu-math>
   <p>
      We can substitute this equation into our cone equation above, and then attempt to solve for the hit distance {{var_Hd_inl}}:
   </p>
   <lu-math>
      <m-row>
         <m-veclength>
            <m-delim>||</m-delim><!--
            --><mark><var>R<sub>o</sub></var> + 
               <var>R<sub>d</sub></var><var>H<sub>d</sub></var></mark> - 
               ((<mark><var>R<sub>o</sub></var> + <var>R<sub>d</sub></var><var>H<sub>d</sub></var></mark> - <var>C<sub>b</sub></var>) &bullet; <var>C<sub>a</sub></var>)<var>C<sub>a</sub></var>
               + <var>C<sub>b</sub></var><!--
         --><m-delim>||</m-delim><!--
      --></m-veclength>
         <nobr>
            = <var>C<sub>r</sub></var>
         </nobr>
      </m-row>
   </lu-math>
   <p>
      Now, we want to pull <lu-math data-inline><var>H<sub>d</sub></var></lu-math> out of that fraction. The first thing we can do is rearrange the nearby dot product. Dot products are commutative in exactly the same ways that scalar multiplications are, so...
   </p>
   <lu-math>
      <m-row>
         {{lu_math_vec_start}}<!--
         --><var>R<sub>o</sub></var> + <var>R<sub>d</sub></var><var>H<sub>d</sub></var> - 
               (<mark>(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
             + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
             - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)</mark>)<var>C<sub>a</sub></var>
             + <var>C<sub>b</sub></var><!--
      -->{{lu_math_vec_end}}
         <nobr>
            = <var>C<sub>r</sub></var>
         </nobr>
      </m-row>
   </lu-math>
   <p>
      The dot product of a vector with itself is the vector's own length squared. This means that we can square both sides to turn our lefthand side into a dot product. Then, we can expand it.
   </p>
   <lu-math>
      <m-solvestep>
         <m-content>
            {{lu_math_vec_start}}<!--
            --><var>R<sub>o</sub></var> + <var>R<sub>d</sub></var><var>H<sub>d</sub></var> - 
               ((<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
             + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
             - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>))<var>C<sub>a</sub></var>
               + <var>C<sub>b</sub></var><!--
         -->{{lu_math_vec_end}}<mark>{{lu_math_sq}}</mark>
            <nobr>
               = <var>C<sub>r</sub></var><mark>{{lu_math_sq}}</mark>
            </nobr>
         </m-content>
      </m-solvestep>
      <m-solvestep>
         <m-layout-snake>
            <m-body>
               <m-layout-v-segments>
                  <m-segment>
                     (<var>R<sub>o</sub></var> + <var>R<sub>d</sub></var><var>H<sub>d</sub></var> - 
                     ((<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                   + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                   - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>))<var>C<sub>a</sub></var>
                     + <var>C<sub>b</sub></var>)
                  </m-segment>
                  <m-sep><mark> + </mark></m-sep>
                  <m-segment>
                     <mark>(<var>R<sub>o</sub></var> + <var>R<sub>d</sub></var><var>H<sub>d</sub></var> - 
                     ((<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                   + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                   - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>))<var>C<sub>a</sub></var>
                     + <var>C<sub>b</sub></var>)</mark>
                  </m-segment>
               </m-layout-v-segments>
            </lu-math-body>
            </m-body>
            <m-tail>
               <nobr>
                  = <var>C<sub>r</sub></var>
               </nobr>
            </m-tail>
         </m-layout-snake>
      </m-solvestep>
   </lu-math>
   <p>
      Now, again, dot products are commutative in the same ways that scalar multiplications are. This means that the following rule works for both scalar variables and vector variables:
   </p>
   <lu-math>
      <m-row>
         <m-content>
            (<var>a</var> + <var>b</var> + <var>c</var> + <var>d</var>){{lu_math_sq}}
            =
            <var>a</var>{{lu_math_sq}}
          + <var>b</var>{{lu_math_sq}}
          + <var>c</var>{{lu_math_sq}}
          + <var>d</var>{{lu_math_sq}}
          + 2<var>a</var><var>b</var>
          + 2<var>a</var><var>c</var>
          + 2<var>a</var><var>d</var>
          + 2<var>b</var><var>c</var>
          + 2<var>b</var><var>d</var>
          + 2<var>c</var><var>d</var>
         </m-content>
      </m-row>
      {{lu_math_therefore_block}}
      <m-givens>
         <label>Given (just for now):</label>
         <dl>
            <dt><var>a</var></dt>
            <m-sep> = </m-sep>
               <dd><var>R<sub>o</sub></var></dd>
            <dt><var>b</var></dt>
            <m-sep> = </m-sep>
               <dd><var>R<sub>d</sub></var><var>H<sub>d</sub></var></dd>
            <dt><var>c</var></dt>
            <m-sep> = </m-sep>
               <dd>
                  -(<!--
                  -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                   + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                   - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
               -->)<var>C<sub>a</sub></var>
               </dd>
            <dt><var>d</var></dt>
            <m-sep> = </m-sep>
               <dd><var>C<sub>b</sub></var></dd>
         </dl>
      </m-givens>
      <m-solvestep>
         <m-layout-snake>
            <m-body>
               <m-layout-v-segments>
                  <m-segment>
                     <mark class="mark-1"><var>R<sub>o</sub></var></mark>{{lu_math_sq}}
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     <mark class="mark-2"><var>R<sub>d</sub></var></mark>{{lu_math_sq}}<mark class="mark-2"><var>H<sub>d</sub></var></mark>{{lu_math_sq}}
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     <mark class="mark-3">((<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var>)</mark>{{lu_math_sq}}
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     <mark class="mark-4"><var>C<sub>b</sub></var></mark>{{lu_math_sq}}
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2<mark class="mark-1"><var>R<sub>o</sub></var></mark><mark class="mark-2"><var>R<sub>d</sub></var><var>H<sub>d</sub></var></mark>
                  </m-segment>
                  <m-sep><mark class="mark-3"> - </mark></m-sep>
                  <m-segment>
                     2<mark class="mark-1"><var>R<sub>o</sub></var></mark><!--
                  --><mark class="mark-3">(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var></mark>
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2<mark class="mark-1"><var>R<sub>o</sub></var></mark><mark class="mark-4"><var>C<sub>b</sub></var></mark>
                  </m-segment>
                  <m-sep><mark class="mark-3"> - </mark></m-sep>
                  <m-segment>
                     2<mark class="mark-2"><var>R<sub>d</sub></var><var>H<sub>d</sub></var></mark><mark class="mark-3">(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var></mark>
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2<mark class="mark-2"><var>R<sub>d</sub></var><var>H<sub>d</sub></var></mark><mark class="mark-4"><var>C<sub>b</sub></var></mark>
                  </m-segment>
                  <m-sep><mark class="mark-3"> - </mark></m-sep>
                  <m-segment>
                     2<!--
                  --><mark class="mark-3">(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var></mark><mark class="mark-4"><var>C<sub>b</sub></var></mark>
                  </m-segment>
               </m-layout-v-segments>
            </m-body>
         </m-layout-snake>
      </m-solvestep>
   </lu-math>
   <p>
      Before we begin, let's be explicit about when we're taking the dot products of vectors, so as to avoid confusion with scalar products &mdash; and avoid getting ourselves into trouble later on. (Given three vectors <lu-math data-inline><var>A</var></lu-math>, <lu-math data-inline><var>B</var></lu-math>, and <lu-math data-inline><var>C</var></lu-math>, you <em>cannot</em> rearrange the expression <lu-math data-inline>(<var>A</var> &bullet; <var>B</var>)<var>C</var></lu-math> in terms of vectors. You can do some fun stuff if <lu-math data-inline><var>C</var></lu-math> is a scalar, but if it's a vector, then this expression is already in its simplest possible form. Expand it into scalars, rearrange terms, and you'll find that the axes of each vector get mixed up: you can't recombine them in any other way. The only way to spot these traps before you walk into them is by explicitly notating dot products.)
   </p>
   <lu-math>
      <m-solvestep>
         <m-layout-snake>
            <m-body>
               <m-layout-v-segments>
                  <m-segment>
                     (<var>R<sub>o</sub></var> &bullet; <var>R<sub>o</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     (<var>R<sub>d</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>{{lu_math_sq}}
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     ((<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var>){{lu_math_sq}}
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     (<var>C<sub>b</sub></var> &bullet; <var>C<sub>b</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <!--
                  -->(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>b</sub></var>)
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2(<var>R<sub>d</sub></var><var>H<sub>d</sub></var> &bullet; (<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>d</sub></var> &bullet; <var>C<sub>b</sub></var>)<var>H<sub>d</sub></var>
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2<!--
                  -->(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var> &bullet; <var>C<sub>b</sub></var>
                  </m-segment>
               </m-layout-v-segments>
            </m-body>
         </m-layout-snake>
      </m-solvestep>
   </lu-math>
   <p>
      <lu-math data-inline>
         ((<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
       + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
       - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)) &bullet; <var>C<sub>a</sub></var>
       </lu-math> is the projection of the ray onto the cylinder's axis; therefore, 
       <lu-math data-inline>
         (<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
       + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
       - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
       </lu-math> is the length of that projection. Squaring the projection pretty much just means taking the dot product of the projection with itself &mdash; taking its length &mdash; so we can remove the multiplication by {{var_Ca_inl}} in that first squared term.
   </p>
   <lu-math>
      <m-solvestep>
         <m-layout-snake>
            <m-body>
               <m-layout-v-segments>
                  <m-segment>
                     (<var>R<sub>o</sub></var> &bullet; <var>R<sub>o</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     (<var>R<sub>d</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>{{lu_math_sq}}
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     <mark>(<del>(</del><!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  --><del>)<var>C<sub>a</sub></var></del>){{lu_math_sq}}</mark>
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     (<var>C<sub>b</sub></var> &bullet; <var>C<sub>b</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <!--
                  -->(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>b</sub></var>)
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2(<var>R<sub>d</sub></var><var>H<sub>d</sub></var> &bullet; (<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>d</sub></var> &bullet; <var>C<sub>b</sub></var>)<var>H<sub>d</sub></var>
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2<!--
                  -->(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var> &bullet; <var>C<sub>b</sub></var>
                  </m-segment>
               </m-layout-v-segments>
            </m-body>
         </m-layout-snake>
      </m-solvestep>
   </lu-math>
   <p>
      Some more dot product commutativity:
   </p>
   <lu-math>
      <m-solvestep>
         <m-content>
            (<var>a</var> + <var>b</var> + <var>c</var>){{lu_math_sq}}
            =
            <var>a</var>{{lu_math_sq}}
          + <var>b</var>{{lu_math_sq}}
          + <var>c</var>{{lu_math_sq}}
          + 2<var>a</var><var>b</var>
          + 2<var>a</var><var>c</var>
          + 2<var>b</var><var>c</var>
         </m-content>
      </m-solvestep>
      {{lu_math_therefore_block}}
      <m-solvestep>
         <m-layout-snake>
            <m-head>
               (<var>R<sub>o</sub></var> &bullet; <var>R<sub>o</sub></var>)
               +
               (<var>R<sub>d</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>{{lu_math_sq}}
            </m-head><!--
         --><m-body>
               <mark data-lu-math-marked-block>
               <m-layout-v-segments>
                  <m-sep> + </m-sep>
                  <m-segment>
                      (<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}<var>H<sub>d</sub></var>{{lu_math_sq}}
                      + (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                      2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                      2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                      2(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                  </m-segment>
               </m-layout-v-segments>
               </mark>
            </m-body>
            <m-tail>
               <m-layout-v-segments>
                  <m-sep> + </m-sep>
                  <m-segment>
                     (<var>C<sub>b</sub></var> &bullet; <var>C<sub>b</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <!--
                  -->(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>b</sub></var>)
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2(<var>R<sub>d</sub></var><var>H<sub>d</sub></var> &bullet; (<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>d</sub></var> &bullet; <var>C<sub>b</sub></var>)<var>H<sub>d</sub></var>
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2<!--
                  -->(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var> &bullet; <var>C<sub>b</sub></var>
                  </m-segment>
               </m-layout-v-segments>
            </m-tail>
         </m-layout-snake>
      </m-solvestep>
      <m-solvestep>
         <m-layout-snake>
            <m-head>
               (<var>R<sub>o</sub></var> &bullet; <var>R<sub>o</sub></var>)
               +
               (<var>R<sub>d</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>{{lu_math_sq}}
            </m-head><!--
         --><m-body>
               <m-layout-v-segments>
                  <m-sep> + </m-sep>
                  <m-segment>
                     <mark class="mark-1">(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}<var>H<sub>d</sub></var>{{lu_math_sq}}</mark>
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     <mark class="mark-2">2(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      - (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>H<sub>d</sub></var></mark>
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                      (<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
                      + (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                      2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
                  </m-segment>
               </m-layout-v-segments>
            </m-body>
            <m-tail>
               <m-layout-v-segments>
                  <m-sep> + </m-sep>
                  <m-segment>
                     (<var>C<sub>b</sub></var> &bullet; <var>C<sub>b</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <!--
                  -->(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>b</sub></var>)
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2(<var>R<sub>d</sub></var><var>H<sub>d</sub></var> &bullet; (<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>d</sub></var> &bullet; <var>C<sub>b</sub></var>)<var>H<sub>d</sub></var>
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2<!--
                  -->(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var> &bullet; <var>C<sub>b</sub></var>
                  </m-segment>
               </m-layout-v-segments>
            </m-tail>
         </m-layout-snake>
      </m-solvestep>
      <m-solvestep>
         <m-layout-snake>
            <m-head>
               (<var>R<sub>o</sub></var> &bullet; <var>R<sub>o</sub></var>)
               +
               (<var>R<sub>d</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>{{lu_math_sq}}
            </m-head><!--
         --><m-body>
               <m-layout-v-segments>
                  <m-sep> + </m-sep>
                  <m-segment>
                     (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}<var>H<sub>d</sub></var>{{lu_math_sq}}
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<mark>(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)</mark><var>H<sub>d</sub></var>
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                      (<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
                      + (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                      2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
                  </m-segment>
               </m-layout-v-segments>
            </m-body>
            <m-tail>
               <m-layout-v-segments>
                  <m-sep> + </m-sep>
                  <m-segment>
                     (<var>C<sub>b</sub></var> &bullet; <var>C<sub>b</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <!--
                  -->(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>b</sub></var>)
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2(<var>R<sub>d</sub></var><var>H<sub>d</sub></var> &bullet; (<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var>)
                  </m-segment>
                  <m-sep> + </m-sep>
                  <m-segment>
                     2(<var>R<sub>d</sub></var> &bullet; <var>C<sub>b</sub></var>)<var>H<sub>d</sub></var>
                  </m-segment>
                  <m-sep> - </m-sep>
                  <m-segment>
                     2<!--
                  -->(<!--
                     -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                      + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                      - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
                  -->)<var>C<sub>a</sub></var> &bullet; <var>C<sub>b</sub></var>
                  </m-segment>
               </m-layout-v-segments>
            </m-tail>
         </m-layout-snake>
      </m-solvestep>
      <m-solvestep>
         <details class="explanation">
            <summary class="toggle-explanation">info</summary>
            <aside>
               Grouped terms by {{var_Hd_inl}}.
            </aside>
         </details>
         <m-layout-v-segments>
            <m-segment>
               (<var>R<sub>o</sub></var> &bullet; <var>R<sub>o</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               <mark>(<!--
               -->(<var>R<sub>d</sub></var> &bullet; <var>R<sub>d</sub></var>)
                + (<var>R<sub>d</sub></var> &bullet; <nobr><var>C<sub>a</sub></var>){{lu_math_sq}}</nobr><!--
            -->)</mark><nobr><var>H<sub>d</sub></var>{{lu_math_sq}}</nobr>
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               2(<!--
               -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
                + <mark>(<var>R<sub>o</sub></var> &bullet; <var>R<sub>d</sub></var>)</mark>
                + <mark>(<var>R<sub>d</sub></var> &bullet; <var>C<sub>b</sub></var>)</mark><!--
            -->)(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>C<sub>b</sub></var> &bullet; <var>C<sub>b</sub></var>)
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <!--
            -->(<!--
               -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
            -->)<var>C<sub>a</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>b</sub></var>)
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<var>R<sub>d</sub></var><var>H<sub>d</sub></var> &bullet; (<!--
               -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
            -->)<var>C<sub>a</sub></var>)
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2<!--
            -->(<!--
               -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
                - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<!--
            -->)<var>C<sub>a</sub></var> &bullet; <var>C<sub>b</sub></var>
            </m-segment>
         </m-layout-v-segments>
      </m-solvestep>
   </lu-math>
   <p>
      Now let's keep simplifying the expression further. We can get a lot of mileage out of the dot products' distributive property.
   </p>
   <lu-math>
      <m-solvestep>
         <details class="explanation">
            <summary class="toggle-explanation">info</summary>
            <aside>
               Using the distributive property of the vector dot product. There are several places where the same group of added-and-subtracted terms gets multiplied by {{var_Ca_inl}}; we can distribute {{var_Ca_inl}} across the group in order to make things easier to work with.
            </aside>
         </details>
         <m-layout-v-segments>
            <m-segment>
               (<var>R<sub>o</sub></var> &bullet; <var>R<sub>o</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<!--
               -->(<var>R<sub>d</sub></var> &bullet; <var>R<sub>d</sub></var>)
                + (<var>R<sub>d</sub></var> &bullet; <nobr><var>C<sub>a</sub></var>){{lu_math_sq}}</nobr><!--
            -->)<nobr><var>H<sub>d</sub></var>{{lu_math_sq}}</nobr>
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               2(<!--
               -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
                + (<var>R<sub>o</sub></var> &bullet; <var>R<sub>d</sub></var>)
                + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>b</sub></var>)<!--
            -->)(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>C<sub>b</sub></var> &bullet; <var>C<sub>b</sub></var>)
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <!--
            -->(<!--
               --><mark>(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>C<sub>a</sub></var>
             + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var><var>C<sub>a</sub></var>
             - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>C<sub>a</sub></var>)</mark><!--
            -->))
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>b</sub></var>)
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<var>R<sub>d</sub></var><var>H<sub>d</sub></var> &bullet; <!--
            -->(<!--
               --><mark>(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>C<sub>a</sub></var>
             + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var><var>C<sub>a</sub></var>
             - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>C<sub>a</sub></var>)</mark><!--
            -->))
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2<!--
            -->(<!--
               --><mark>(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>C<sub>a</sub></var>
                + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var><var>C<sub>a</sub></var>
                - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>C<sub>a</sub></var>)</mark><!--
            -->) &bullet; <var>C<sub>b</sub></var>
            </m-segment>
         </m-layout-v-segments>
      </m-solvestep>
      <m-solvestep>
         <details class="explanation">
            <summary class="toggle-explanation">info</summary>
            <aside>
               Now, we're doing the exact same thing as in the last step, but to the content we've just distributed.
            </aside>
         </details>
         <m-layout-v-segments>
            <m-segment>
               (<var>R<sub>o</sub></var> &bullet; <var>R<sub>o</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<!--
               -->(<var>R<sub>d</sub></var> &bullet; <var>R<sub>d</sub></var>)
                + (<var>R<sub>d</sub></var> &bullet; <nobr><var>C<sub>a</sub></var>){{lu_math_sq}}</nobr><!--
            -->)<nobr><var>H<sub>d</sub></var>{{lu_math_sq}}</nobr>
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               2(<!--
               -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
                + (<var>R<sub>o</sub></var> &bullet; <var>R<sub>d</sub></var>)
                + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>b</sub></var>)<!--
            -->)(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>C<sub>b</sub></var> &bullet; <var>C<sub>b</sub></var>)
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<!--
               -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)<mark>(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)</mark>
                + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<mark>(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)</mark><var>H<sub>d</sub></var>
                - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<mark>(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)</mark><!--
            -->)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>b</sub></var>)
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<!--
               -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)<mark>(<var>C<sub>a</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var></mark>
                + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<mark>(<var>C<sub>a</sub></var> &bullet; <var>R<sub>d</sub></var>)</mark><var>H<sub>d</sub></var><mark>{{lu_math_sq}}</mark>
                - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<mark>(<var>C<sub>a</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var></mark><!--
            -->)
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               (<!--
               --><mark>2</mark>(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>C<sub>a</sub></var>
                + <mark>2</mark>(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var><var>C<sub>a</sub></var>
                - <mark>2</mark>(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>C<sub>a</sub></var>)<!--
            -->) &bullet; <var>C<sub>b</sub></var>
            </m-segment>
         </m-layout-v-segments>
      </m-solvestep>
      <m-solvestep>
         <details class="explanation">
            <summary class="toggle-explanation">info</summary>
            <aside>
               We distributed a multiplication by 2 in the last step; now, we can distribute a dot product by {{var_Cb_inl}} across that same group. We'll also distribute the other multiplications by 2.
            </aside>
         </details>
         <m-layout-v-segments>
            <m-segment>
               (<var>R<sub>o</sub></var> &bullet; <var>R<sub>o</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<!--
               -->(<var>R<sub>d</sub></var> &bullet; <var>R<sub>d</sub></var>)
                + (<var>R<sub>d</sub></var> &bullet; <nobr><var>C<sub>a</sub></var>){{lu_math_sq}}</nobr><!--
            -->)<nobr><var>H<sub>d</sub></var>{{lu_math_sq}}</nobr>
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               2(<!--
               -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
                + (<var>R<sub>o</sub></var> &bullet; <var>R<sub>d</sub></var>)
                + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>b</sub></var>)<!--
            -->)(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>C<sub>b</sub></var> &bullet; <var>C<sub>b</sub></var>)
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               <mark class="mark-2">2</mark>(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
             + <mark class="mark-2">2</mark>(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
             - <mark class="mark-2">2</mark>(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>b</sub></var>)
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               <mark class="mark-2">2</mark>(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>a</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>
             + <mark class="mark-2">2</mark>(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>a</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>{{lu_math_sq}}
             - <mark class="mark-2">2</mark>(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>a</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)<mark class="mark-1">(<var>C<sub>a</sub></var> &bullet; <var>C<sub>b</sub></var>)</mark>
             + 2(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<mark class="mark-1">(<var>C<sub>a</sub></var> &bullet; <var>C<sub>b</sub></var>)</mark><var>H<sub>d</sub></var>
             - 2(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)<mark class="mark-1">(<var>C<sub>a</sub></var> &bullet; <var>C<sub>b</sub></var>)</mark>
            </m-segment>
         </m-layout-v-segments>
      </m-solvestep>
      <m-solvestep>
         <details class="explanation">
            <summary class="toggle-explanation">info</summary>
            <aside>
               There were terms in this equation that canceled each other out.
            </aside>
         </details>
         <m-layout-v-segments>
            <m-segment>
               (<var>R<sub>o</sub></var> &bullet; <var>R<sub>o</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<!--
               -->(<var>R<sub>d</sub></var> &bullet; <var>R<sub>d</sub></var>)
                + (<var>R<sub>d</sub></var> &bullet; <nobr><var>C<sub>a</sub></var>){{lu_math_sq}}</nobr><!--
            -->)<nobr><var>H<sub>d</sub></var>{{lu_math_sq}}</nobr>
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               2(<!--
               -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
                + (<var>R<sub>o</sub></var> &bullet; <var>R<sub>d</sub></var>)
                + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>b</sub></var>)<!--
            -->)(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>){{lu_math_sq}}
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>C<sub>b</sub></var> &bullet; <var>C<sub>b</sub></var>)
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
             - 2(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>b</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               2(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>a</sub></var> &bullet; <var>R<sub>d</sub></var>)<var>H<sub>d</sub></var>{{lu_math_sq}}
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               2(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>a</sub></var> &bullet; <var>C<sub>b</sub></var>)
             - 2(<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)(<var>C<sub>a</sub></var> &bullet; <var>C<sub>b</sub></var>)
            </m-segment>
         </m-layout-v-segments>
      </m-solvestep>
      <m-solvestep>
         <details class="explanation">
            <summary class="toggle-explanation">info</summary>
            <aside>
               Combining terms, and reordering variables within groups for easier matching.
            </aside>
         </details>
         <m-layout-v-segments>
            <m-segment>
               (<var>R<sub>o</sub></var> &bullet; <var>R<sub>o</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<!--
               -->(<var>R<sub>d</sub></var> &bullet; <var>R<sub>d</sub></var>)
                + <mark>3</mark>(<var>C<sub>a</sub></var> &bullet; <nobr><var>R<sub>D</sub></var>){{lu_math_sq}}</nobr><!--
            -->)<nobr><var>H<sub>d</sub></var>{{lu_math_sq}}</nobr>
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               2(<!--
               -->(<var>R<sub>o</sub></var> &bullet; <var>C<sub>a</sub></var>)
                - (<var>C<sub>b</sub></var> &bullet; <var>C<sub>a</sub></var>)
                + (<var>R<sub>o</sub></var> &bullet; <var>R<sub>d</sub></var>)
                + (<var>R<sub>d</sub></var> &bullet; <var>C<sub>b</sub></var>)<!--
            -->)(<var>R<sub>d</sub></var> &bullet; <var>C<sub>a</sub></var>)<var>H<sub>d</sub></var>
            </m-segment>
            <m-sep><mark> - </mark></m-sep>
            <m-segment>
               (<var>C<sub>a</sub></var> &bullet; <var>R<sub>o</sub></var>){{lu_math_sq}}
            </m-segment>
            <m-sep><mark> - </mark></m-sep>
            <m-segment>
               (<var>C<sub>a</sub></var> &bullet; <var>C<sub>b</sub></var>){{lu_math_sq}}
            </m-segment>
            <m-sep> - </m-sep>
            <m-segment>
               <mark>6</mark>(<var>C<sub>a</sub></var> &bullet; <var>R<sub>o</sub></var>)(<var>C<sub>a</sub></var> &bullet; <var>C<sub>b</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               (<var>C<sub>b</sub></var> &bullet; <var>C<sub>b</sub></var>)
            </m-segment>
            <m-sep> + </m-sep>
            <m-segment>
               2(<var>C<sub>b</sub></var> &bullet; <var>R<sub>o</sub></var>)
            </m-segment>
         </m-layout-v-segments>
      </m-solvestep>
   </lu-math>
</section>